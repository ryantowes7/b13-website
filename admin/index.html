<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>B13 Factory CMS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Netlify Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <!-- Netlify CMS (pakai yang lama, bukan netlify-cms-app) -->
    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
  </head>
  <body>
    <div style="text-align:center; margin-top:50px;">
      <h2>B13 Factory CMS</h2>
      <p>Loading Content Manager...</p>
    </div>

    <script>
      // Auto redirect login dengan Netlify Identity
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", (user) => {
          if (!user) {
            window.netlifyIdentity.on("login", () => {
              document.location.href = "/admin/";
            });
          }
        });
      }

      // Auto-login for development
      const allowedEmails = ["your-email@gmail.com", "your-other@email.com"]; // Ganti dengan email Anda

      window.netlifyIdentity.on("init", function(user) {
        if (!user) {
          // Try to auto-login
          const storedEmail = localStorage.getItem('b13-admin-email');
          if (storedEmail && allowedEmails.includes(storedEmail)) {
            window.netlifyIdentity.login({
              email: storedEmail,
              password: 'b13-factory-admin'
            });
          }
        }
      });

      // Auto-open login if no token
      setTimeout(function() {
        if (!window.location.hash && !window.netlifyIdentity.currentUser()) {
          window.netlifyIdentity.open('login');
        }
      }, 2000);
    
    </script>
  </body>
</html>
